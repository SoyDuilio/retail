<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Vendedor</title>
    
    <!-- CSS Modular -->
    <link rel="stylesheet" href="/static/css/vendedor/header.css">
    <link rel="stylesheet" href="/static/css/vendedor/busqueda.css">
    <link rel="stylesheet" href="/static/css/vendedor/vendedor-dashboard.css">
    <link rel="stylesheet" href="/static/css/vendedor/ventas_externas.css">
    <link rel="stylesheet" href="/static/css/vendedor/modal_nuevo_cliente.css">
    <link rel="stylesheet" href="/static/css/vendedor/gps_tracker.css">
</head>
<body>
    
    <!-- Header simplificado -->
    <header class="header-sticky">
        <div class="header-content-simple">
            <!-- Cliente + Info Cr√©dito -->
            <div class="chip-cliente-header hidden" id="chipClienteHeader">
                <span class="chip-icono">üè™</span>
                <div class="chip-info">
                    <span class="chip-nombre" id="chipClienteNombreHeader"></span>
                    <span class="chip-tipo" id="chipClienteTipoHeader"></span>
                </div>

                <!-- ‚úÖ NUEVO: Bot√≥n cambiar cliente -->
                <button class="chip-btn-cambiar" onclick="cambiarCliente()" title="Cambiar cliente">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
                
                <button class="btn-credito-mini" id="btnInfoCredito">
                    <span id="creditoIcono">üí≥</span>
                    <span id="creditoResumen">Ver cr√©dito</span>
                </button>
            </div>

            

            <!-- Bot√≥n logout -->
            <button class="btn-logout" onclick="logout()">
                <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
                </svg>
            </button>
        </div>
    </header>

    <!-- Template del popover de cr√©dito -->
    <div id="creditoPopoverTemplate" style="display: none;">
        <div class="credito-popover-content">
            <div class="credito-row">
                <span class="label">L√≠mite Total:</span>
                <span class="value credito-limite">S/ 0.00</span>
            </div>
            <div class="credito-row">
                <span class="label">Cr√©dito Usado:</span>
                <span class="value credito-usado">S/ 0.00</span>
            </div>
            <div class="credito-row highlighted">
                <span class="label">üí∞ Disponible:</span>
                <span class="value credito-disponible">S/ 0.00</span>
            </div>
            <hr style="margin: 0.5rem 0; border-color: #e0e0e0;">
            <div class="credito-row">
                <span class="label">Deuda:</span>
                <span class="value text-danger credito-deuda">S/ 0.00</span>
            </div>
            <div class="credito-row">
                <span class="label">Estado:</span>
                <span class="value credito-estado-texto">Al d√≠a</span>
            </div>
        </div>
    </div>

    <div class="container-main">
        <div class="seccion-busqueda-combinada">
            <div class="glass-card">
                
                <!-- 1. B√∫squeda de Cliente (SE OCULTA al seleccionar) -->
                <div class="busqueda-cliente-wrapper" id="busquedaClienteWrapper">
                    <label class="input-label">Cliente</label>
                    <div class="input-group-compacto">
                        <input type="text" id="inputBusquedaCliente" class="input-compacto"
                            placeholder="RUC, nombre o WhatsApp ..." autocomplete="off">
                        <button class="btn-mic-compacto" id="micCliente" onclick="iniciarDictadoCliente()">
                            <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"></path>
                            </svg>
                        </button>
                        <button type="button" class="btn-nuevo-cliente" id="btnNuevoCliente">
                            <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                            </svg>
                        </button>
                    </div>
                    <div class="dropdown-resultados hidden" id="dropdownClientes"></div>
                </div>

                <!-- 2. Chip de Cliente (APARECE al seleccionar) -->
                

                <!-- 3. B√∫squeda de Productos (APARECE despu√©s de seleccionar cliente) -->
                <div class="busqueda-productos hidden" id="busquedaProductos">
                    <label class="input-label">Buscar Productos</label>
                    <div class="input-group-compacto">
                        <input type="text" id="inputProductos" class="input-compacto"
                            placeholder="C√≥digo o nombre del producto..." autocomplete="off" disabled>
                        <button class="btn-mic-compacto" id="micBrowser" onclick="toggleRecordingBrowser()">
                            <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"></path>
                            </svg>
                        </button>
                    </div>
                    <div class="dropdown-productos hidden" id="dropdownProductos">
                        <div class="dropdown-productos-header">
                            <span id="countSeleccionados">0 seleccionados</span>
                            <button class="btn-agregar-productos hidden" id="btnAgregarProductos" onclick="agregarProductosSeleccionados()">
                                Agregar
                            </button>
                        </div>
                        <div class="dropdown-productos-lista" id="listaProductosDropdown"></div>
                    </div>
                </div>

            </div>
        </div>

        <!-- Lista de productos del pedido -->
        <!-- REEMPLAZAR desde aqu√≠ -->
        <div class="productos-pedido hidden" id="productosContainer">
            <div class="glass-card">
                <div class="pedido-header">
                    <h3 class="pedido-titulo">Productos del Pedido</h3>
                    <button class="btn-limpiar" onclick="limpiarPedido()">Limpiar</button>
                </div>
                <div class="lista-productos" id="listaProductos"></div>
                
                <!-- ‚úÖ NUEVO: Footer con comparaci√≥n integrado -->
                <div class="pedido-footer-nuevo">
                    <!-- Fila 1: Total principal (siempre visible) -->
                    <div class="footer-total-principal">
                        <span class="total-label">Total:</span>
                        <span class="total-monto" id="totalPedido">S/ 0.00</span>
                    </div>
                    
                    <!-- Fila 2: Comparaci√≥n CONTADO/CR√âDITO (visible solo con cliente) -->
                    <div class="footer-comparacion hidden" id="footerComparacion">
                        <div class="comparacion-grid">
                            <div class="comparacion-item" onclick="seleccionarTipoPago('CREDITO')" id="btnCreditoComparacion">
                                <span class="comp-label">CR√âDITO</span>
                                <span class="comp-valor" id="totalCreditoComparacion">S/ 0.00</span>
                            </div>

                            <div class="comparacion-divider">vs</div>

                            <div class="comparacion-item" onclick="seleccionarTipoPago('CONTADO')" id="btnContadoComparacion">
                                <span class="comp-label">CONTADO</span>
                                <span class="comp-valor" id="totalContadoComparacion">S/ 0.00</span>
                            </div>
                            
                            <div class="comparacion-ahorro">
                                <span class="ahorro-icono">üê∑</span>
                                <span class="ahorro-valor" id="ahorroMonto">S/ 0.00</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Bot√≥n confirmar -->
                    <button class="btn-confirmar-pedido" onclick="confirmarPedido()">
                        CONFIRMAR PEDIDO
                    </button>
                </div>
            </div>
        </div>
        <!-- HASTA aqu√≠ -->

    <!-- Barra inferior con accesos r√°pidos -->
    <div class="barra-inferior">
        <button class="btn-estadistica" onclick="mostrarModalMeta()" title="Meta del d√≠a">
            <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
            </svg>
            <span>Meta</span>
        </button>
        <button class="btn-estadistica" onclick="mostrarModalPedidos()" title="Pedidos del d√≠a">
            <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"></path>
            </svg>
            <span>Pedidos</span>
        </button>
        <button class="btn-estadistica" onclick="mostrarModalRanking()" title="Ranking">
            <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
            </svg>
            <span>Ranking</span>
        </button>
        <button class="btn-estadistica" onclick="mostrarMenuMas()" title="M√°s opciones">
            <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
            </svg>
            <span>M√°s</span>
        </button>
    </div>

    <!-- Modal de Ubicaci√≥n -->
    <div id="modalUbicacion" class="modal-overlay hidden">
        <div class="modal-content">
            <!-- ‚úÖ Agregar bot√≥n cerrar si no existe -->
            <button class="modal-close" data-close-modal aria-label="Cerrar">
                <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
            </button>
            
            <h2 class="modal-titulo">Ubicaci√≥n GPS</h2>
            <p class="modal-descripcion">Necesitamos tu ubicaci√≥n para registrar el pedido</p>
            
            <div id="contenidoUbicacion">
                <!-- Contenido din√°mico -->
            </div>
        </div>
    </div>

    <!-- Modal Nuevo Cliente -->
    <!-- ========== MODAL NUEVO CLIENTE ========== -->
    <!-- ========== MODAL NUEVO CLIENTE - DISE√ëO CARDS FLOTANTES ========== -->
    <div id="modalNuevoCliente" class="modal-overlay">
        <div class="modal-container">
            
            <!-- Header con Progress -->
            <div class="modal-header-modern">
                <div class="header-content">
                    <h2 class="modal-title">
                        <span class="title-icon">‚ú®</span>
                        Registrar Nuevo Cliente
                    </h2>
                    <button type="button" class="btn-close-modern" id="btnCerrarModalCliente">
                        <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                        </svg>
                    </button>
                </div>
                
                <!-- Progress Steps -->
                <div class="progress-steps">
                    <div class="step-item active" data-step="1">
                        <div class="step-circle">
                            <span class="step-number">1</span>
                            <svg class="step-check" width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"/>
                            </svg>
                        </div>
                        <span class="step-label">Validaci√≥n</span>
                    </div>
                    <div class="step-line"></div>
                    <div class="step-item" data-step="2">
                        <div class="step-circle">
                            <span class="step-number">2</span>
                            <svg class="step-check" width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"/>
                            </svg>
                        </div>
                        <span class="step-label">Ubicaci√≥n</span>
                    </div>
                    <div class="step-line"></div>
                    <div class="step-item" data-step="3">
                        <div class="step-circle">
                            <span class="step-number">3</span>
                            <svg class="step-check" width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"/>
                            </svg>
                        </div>
                        <span class="step-label">Condiciones</span>
                    </div>
                </div>
            </div>

            <!-- Form Container -->
            <form id="formNuevoCliente">
                <div class="modal-body-modern">
                    
                    <!-- ========== PASO 1: VALIDACI√ìN ========== -->
                    <div class="wizard-card active" data-step="1">
                        <div class="card-header">
                            <div class="card-icon">üîç</div>
                            <div class="card-title-group">
                                <h3 class="card-title">Validar Identidad</h3>
                                <p class="card-subtitle">Ingresa RUC de la empresa y DNI del titular</p>
                            </div>
                        </div>

                        <div class="card-body">
                            <!-- RUC -->
                            <div class="form-group-modern">
                                <label class="label-modern">
                                    <span class="label-text">RUC de la Empresa</span>
                                    <span class="label-required">*</span>
                                </label>
                                <div class="input-group-modern">
                                    <div class="input-icon">üè¢</div>
                                    <input 
                                        type="text" 
                                        id="numero_ruc" 
                                        class="input-modern" 
                                        placeholder="20123456789"
                                        maxlength="11"
                                        inputmode="numeric"
                                        autocomplete="off"
                                    >
                                    <button type="button" class="btn-validate" id="btnValidarRuc">
                                        <svg class="btn-icon" width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                                        </svg>
                                        Validar
                                    </button>
                                </div>
                                <div class="input-feedback" id="feedbackRuc"></div>
                            </div>

                            <!-- Datos SUNAT (ocultos inicialmente) -->
                            <div class="datos-validados hidden" id="datosRuc">
                                <div class="alert-success">
                                    <svg width="20" height="20" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                                    </svg>
                                    <span>RUC validado correctamente con SUNAT</span>
                                </div>

                                <div class="form-group-modern">
                                    <label class="label-modern">
                                        <span class="label-text">Raz√≥n Social</span>
                                    </label>
                                    <input 
                                        type="text" 
                                        id="razon_social" 
                                        class="input-modern input-readonly" 
                                        readonly
                                    >
                                </div>

                                <div class="form-group-modern">
                                    <label class="label-modern">
                                        <span class="label-text">Nombre Comercial</span>
                                        <span class="label-hint">Puedes editarlo</span>
                                    </label>
                                    <input 
                                        type="text" 
                                        id="nombre_comercial" 
                                        class="input-modern" 
                                        placeholder="Ej: Bodega San Mart√≠n"
                                    >
                                </div>
                            </div>

                            <!-- DNI Titular -->
                            <div class="form-group-modern" style="margin-top: 24px;">
                                <label class="label-modern">
                                    <span class="label-text">DNI del Titular/Due√±o</span>
                                    <span class="label-required">*</span>
                                </label>
                                <div class="input-group-modern">
                                    <div class="input-icon">üë§</div>
                                    <input 
                                        type="text" 
                                        id="numero_dni" 
                                        class="input-modern" 
                                        placeholder="12345678"
                                        maxlength="8"
                                        inputmode="numeric"
                                        autocomplete="off"
                                    >
                                    <button type="button" class="btn-validate" id="btnValidarDni">
                                        <svg class="btn-icon" width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                                        </svg>
                                        Validar
                                    </button>
                                </div>
                                <div class="input-feedback" id="feedbackDni"></div>
                            </div>

                            <!-- Datos RENIEC (ocultos inicialmente) -->
                            <div class="datos-validados hidden" id="datosDni">
                                <div class="alert-success">
                                    <svg width="20" height="20" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                                    </svg>
                                    <span>DNI validado correctamente con RENIEC</span>
                                </div>

                                <div class="form-group-modern">
                                    <label class="label-modern">
                                        <span class="label-text">Nombres Completos</span>
                                    </label>
                                    <input 
                                        type="text" 
                                        id="nombres_titular" 
                                        class="input-modern input-readonly" 
                                        readonly
                                    >
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ========== PASO 2: UBICACI√ìN ========== -->
                    <div class="wizard-card" data-step="2">
                        <div class="card-header">
                            <div class="card-icon">üìç</div>
                            <div class="card-title-group">
                                <h3 class="card-title">Contacto y Ubicaci√≥n</h3>
                                <p class="card-subtitle">Datos para contacto y entrega de pedidos</p>
                            </div>
                        </div>

                        <div class="card-body">
                            <div class="form-row-2">
                                <div class="form-group-modern">
                                    <label class="label-modern">
                                        <span class="label-text">Tel√©fono / WhatsApp</span>
                                        <span class="label-required">*</span>
                                    </label>
                                    <div class="input-with-icon">
                                        <div class="input-icon">üì±</div>
                                        <input 
                                            type="text" 
                                            id="telefono" 
                                            class="input-modern" 
                                            placeholder="987654321"
                                            maxlength="9"
                                            inputmode="numeric"
                                        >
                                    </div>
                                </div>

                                <div class="form-group-modern">
                                    <label class="label-modern">
                                        <span class="label-text">Email</span>
                                        <span class="label-hint">Opcional</span>
                                    </label>
                                    <div class="input-with-icon">
                                        <div class="input-icon">‚úâÔ∏è</div>
                                        <input 
                                            type="email" 
                                            id="email" 
                                            class="input-modern" 
                                            placeholder="correo@ejemplo.com"
                                        >
                                    </div>
                                </div>
                            </div>

                            <div class="form-group-modern">
                                <label class="label-modern">
                                    <span class="label-text">Direcci√≥n Completa</span>
                                    <span class="label-required">*</span>
                                </label>
                                <input 
                                    type="text" 
                                    id="direccion" 
                                    class="input-modern" 
                                    placeholder="Jr. Los Rosales 123"
                                >
                            </div>

                            <div class="form-group-modern">
                                <label class="label-modern">
                                    <span class="label-text">Referencia</span>
                                </label>
                                <input 
                                    type="text" 
                                    id="referencia" 
                                    class="input-modern" 
                                    placeholder="A dos cuadras del mercado, frente al parque"
                                >
                                <small class="input-hint-bottom">üí° Ayuda al vendedor a encontrar el lugar</small>
                            </div>

                            <div class="form-row-3">

                                <!-- Departamento -->
                                <div class="form-group">
                                    <label>Departamento *</label>
                                    <input 
                                        type="text" 
                                        id="departamento_sunat" 
                                        class="input-modern"
                                        readonly
                                        placeholder="Se llenar√° autom√°ticamente"
                                    />
                                </div>

                                <!-- Provincia -->
                                <div class="form-group">
                                    <label>Provincia *</label>
                                    <input 
                                        type="text" 
                                        id="provincia_sunat" 
                                        class="input-modern"
                                        readonly
                                        placeholder="Se llenar√° autom√°ticamente"
                                    />
                                </div>

                                <!-- Distrito -->
                                <div class="form-group">
                                    <label>Distrito *</label>
                                    <input 
                                        type="text" 
                                        id="distrito_sunat" 
                                        class="input-modern"
                                        readonly
                                        placeholder="Se llenar√° autom√°ticamente"
                                    />
                                </div>

                            </div>
                        </div>
                    </div>

                    <!-- ========== PASO 3: TIPO DE CLIENTE Y RESUMEN ========== -->
                    <div class="wizard-card" data-step="3">
                        <div class="card-header">
                            <div class="card-icon">üè™</div>
                            <div class="card-title-group">
                                <h3 class="card-title">Clasificaci√≥n del Cliente</h3>
                                <p class="card-subtitle">Selecciona el tipo de establecimiento</p>
                            </div>
                        </div>

                        <div class="card-body">
                            <div class="form-group-modern">
                                <label class="label-modern">
                                    <span class="label-text">Tipo de Cliente</span>
                                    <span class="label-required">*</span>
                                </label>
                                <select id="tipo_cliente" class="select-modern">
                                    <option value="">Seleccionar tipo de cliente</option>
                                    <option value="1">Bodega</option>
                                    <option value="2">Puesto de Mercado</option>
                                    <option value="3">Restaurante</option>
                                    <option value="4">Distribuidor</option>
                                    <option value="5">Minimarket</option>
                                    <option value="6">Otros</option>
                                </select>
                                <small class="input-hint-bottom">üí° Esta clasificaci√≥n determina las pol√≠ticas comerciales aplicables</small>
                            </div>

                            <!-- Informaci√≥n de Pol√≠tica (solo informativa) -->
                            <div class="info-politica hidden" id="infoPolitica">
                                <div class="alert-info">
                                    <svg width="20" height="20" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
                                    </svg>
                                    <div>
                                        <strong>Pol√≠tica comercial aplicable:</strong>
                                        <div class="politica-detalles">
                                            <span>‚Ä¢ L√≠mite de cr√©dito m√°ximo: <strong id="limiteCreditoMax">-</strong></span>
                                            <span>‚Ä¢ D√≠as de cr√©dito m√°ximo: <strong id="diasCreditoMax">-</strong></span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Resumen Final -->
                            <div class="resumen-card">
                                <h4 class="resumen-titulo">üìã Resumen del Registro</h4>
                                <div class="resumen-grid">
                                    <div class="resumen-item">
                                        <span class="resumen-label">RUC:</span>
                                        <span class="resumen-value" id="resumenRuc">-</span>
                                    </div>
                                    <div class="resumen-item">
                                        <span class="resumen-label">Raz√≥n Social:</span>
                                        <span class="resumen-value" id="resumenRazon">-</span>
                                    </div>
                                    <div class="resumen-item">
                                        <span class="resumen-label">Nombre Comercial:</span>
                                        <span class="resumen-value" id="resumenNombre">-</span>
                                    </div>
                                    <div class="resumen-item">
                                        <span class="resumen-label">Titular:</span>
                                        <span class="resumen-value" id="resumenTitular">-</span>
                                    </div>
                                    <div class="resumen-item">
                                        <span class="resumen-label">Tel√©fono:</span>
                                        <span class="resumen-value" id="resumenTelefono">-</span>
                                    </div>
                                    <div class="resumen-item">
                                        <span class="resumen-label">Direcci√≥n:</span>
                                        <span class="resumen-value" id="resumenDireccion">-</span>
                                    </div>
                                    <div class="resumen-item">
                                        <span class="resumen-label">Tipo de Cliente:</span>
                                        <span class="resumen-value" id="resumenTipoCliente">-</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>

                <!-- Footer con Botones -->
                <!-- Footer sticky con total y comparaci√≥n -->
                <div class="pedido-footer-sticky hidden" id="pedidoFooterSticky">
                    <!-- Fila 1: Total principal -->
                    <div class="footer-total-principal">
                        <span class="total-label">Total:</span>
                        <span class="total-monto" id="totalPedido">S/ 0.00</span>
                    </div>
                    
                    <!-- Fila 2: Comparaci√≥n (solo visible con cliente) -->
                    <div class="footer-comparacion hidden" id="footerComparacion">
                        <div class="comparacion-item">
                            <span class="comp-label">CR√âDITO</span>
                            <span class="comp-valor" id="totalCreditoComparacion">S/ 0.00</span>
                        </div>
                        
                        <div class="comparacion-divider">vs</div>
                        
                        <div class="comparacion-item">
                            <span class="comp-label">CONTADO</span>
                            <span class="comp-valor" id="totalContadoComparacion">S/ 0.00</span>
                        </div>
                        
                        <div class="comparacion-ahorro">
                            <span class="ahorro-icono">üê∑</span>
                            <span class="ahorro-valor" id="ahorroMonto">S/ 0.00</span>
                        </div>
                    </div>
                    
                    <!-- Bot√≥n confirmar -->
                    <button class="btn-confirmar-pedido" onclick="confirmarPedido()">
                        CONFIRMAR PEDIDO
                    </button>
                </div>
            </form>

        </div>
    </div>

    <!-- Modal de Confirmaci√≥n de Pedido -->
    <div class="modal-overlay hidden" id="modalConfirmarPedido">
        <div class="modal-medium">
            <div class="modal-header">
                <h3>Confirmar Pedido</h3>
                <button class="btn-close-modal" onclick="cerrarModal('modalConfirmarPedido')">
                    <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-modal">
                    <div class="form-group">
                        <label>Modalidad de Pago</label>
                        <select id="modalidadPago" class="select-pago">
                            <option value="efectivo_cash">Efectivo - CASH</option>
                            <option value="efectivo_yape">Efectivo - Yape</option>
                            <option value="efectivo_plin">Efectivo - Plin</option>
                            <option value="credito_15_dias" selected>Cr√©dito 15 d√≠as</option>
                            <option value="credito_30_dias">Cr√©dito 30 d√≠as</option>
                            <option value="credito_45_dias">Cr√©dito 45 d√≠as</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Observaciones (opcional)</label>
                        <textarea id="observacionesPedido" rows="3" placeholder="Comentarios adicionales"></textarea>
                    </div>
                    <div class="alert-coincidencia" id="alertCoincidencia"></div>
                    <button class="btn-primary" onclick="enviarPedidoFinal()">
                        ENVIAR PEDIDO
                    </button>
                </div>
            </div>
        </div>
    </div>


    <!-- Modal Pedidos del D√≠a -->
    <div class="modal-overlay hidden" id="modalPedidos">
        <div class="modal-large">
            <div class="modal-header">
                <h3>üì¶ Pedidos del D√≠a</h3>
                <button class="btn-close-modal" onclick="cerrarModal('modalPedidos')">
                    <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="stats-resumen">
                    <div class="stat-card">
                        <div class="stat-numero" id="totalPedidosHoy">0</div>
                        <div class="stat-titulo">Total Pedidos</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-numero" id="totalVentasHoy">S/ 0</div>
                        <div class="stat-titulo">Total Ventas</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-numero" id="pendientesHoy">0</div>
                        <div class="stat-titulo">Pendientes</div>
                    </div>
                </div>
                
                <div id="listaPedidosHoy" class="lista-pedidos-modal">
                    <div class="loading-state">
                        <div class="spinner"></div>
                        <p>Cargando pedidos...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- TTS Client -->
    <script src="/static/js/tts_client.js"></script>
    <script src="/static/js/vendedor/modal_nuevo_cliente.js"></script>
    <script src="/static/js/vendedor/ventas_externas.js"></script>
    <script src="/static/js/vendedor/gps_tracker.js"></script> <!-- ‚úÖ AGREGAR -->
    
    <!-- ‚úÖ NUEVO: Sistema de precios -->
    <script src="/static/js/vendedor/pedido-precios.js"></script>
    
    <!-- CSS GPS Tracker -->
    <link rel="stylesheet" href="/static/css/vendedor/gps_tracker.css"> <!-- ‚úÖ AGREGAR -->
    
</body>
</html>