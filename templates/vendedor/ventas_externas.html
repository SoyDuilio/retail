<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Vendedor - Sistema Distribución</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#1e3a8a',
                        secondary: '#3b82f6'
                    }
                }
            }
        }
    </script>
    <link rel="stylesheet" href="css/vendedor/ventas_externas.css">
</head>
<body class="bg-gradient-to-br from-blue-900 via-blue-800 to-indigo-900 min-h-screen">
    <!-- Header compacto -->
    <header class="glass-effect p-3">
        <div class="container mx-auto flex justify-between items-center">
            <div class="flex items-center space-x-3">
                <div class="w-10 h-10 bg-blue-500 rounded-full flex items-center justify-center">
                    <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                    </svg>
                </div>
                <div>
                    <h1 class="text-white text-sm font-semibold" id="vendedorNombre">Loading...</h1>
                    <p class="text-blue-200 text-xs" id="vendedorCodigo">Vendedor</p>
                </div>
            </div>
            <div class="flex items-center space-x-4">
                <!-- Estadísticas compactas -->
                <div class="hidden md:flex space-x-4 text-xs">
                    <div class="text-center">
                        <p class="text-green-400 font-bold" id="pedidosHoy">0</p>
                        <p class="text-blue-200">Pedidos</p>
                    </div>
                    <div class="text-center">
                        <p class="text-blue-400 font-bold" id="ventasHoy">S/0</p>
                        <p class="text-blue-200">Ventas</p>
                    </div>
                </div>
                <button onclick="logout()" class="text-blue-200 hover:text-white transition-colors">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
                    </svg>
                </button>
            </div>
        </div>
    </header>

    <div class="container mx-auto px-4 py-4">
        <!-- Input Principal Inteligente -->
        <div class="glass-effect p-4 rounded-xl mb-4">
            <div class="space-y-3">
                <!-- Input de productos -->
                <div class="relative">
                    <input
                        type="text"
                        id="inputProductos"
                        placeholder="Escribe o dicta pedido: '2 cajas coca cola 500ml, 1 docena jabón camay'"
                        class="w-full pl-4 pr-16 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-blue-300 focus:outline-none focus:border-blue-400 text-sm"
                        onkeypress="handleEnterProductos(event)"
                    >
                    <!-- CAMBIO: Contenedor para los dos botones de micrófono -->
                    <div class="absolute right-3 top-1/2 transform -translate-y-1/2 flex items-center space-x-2">
                        <!-- Botón 1: Micrófono del Navegador (Rápido) -->
                        <button
                            id="micBrowser"
                            onclick="toggleRecordingBrowser()"
                            title="Usar micrófono del navegador (Rápido)"
                            class="w-8 h-8 bg-blue-500 hover:bg-blue-600 rounded-full flex items-center justify-center transition-colors"
                        >
                            <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"></path>
                            </svg>
                        </button>
                        <!-- Botón 2: Micrófono de Google (Preciso) -->
                        <button
                            id="micGoogle"
                            onclick="toggleRecordingGoogle()"
                            title="Usar micrófono de Google (Preciso)"
                            class="w-8 h-8 bg-gradient-to-r from-red-500 to-yellow-500 hover:opacity-90 rounded-full flex items-center justify-center transition-opacity"
                        >
                            <!-- Icono de Google Lens / Asistente -->
                            <svg class="w-5 h-5 text-white" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M4.5 12.5C4.5 15.26 6.74 17.5 9.5 17.5C10.63 17.5 11.66 17.13 12.5 16.5V12.5H9.5C8.12 12.5 7 11.38 7 10C7 8.62 8.12 7.5 9.5 7.5H12.5V4.5C11.66 3.87 10.63 3.5 9.5 3.5C6.74 3.5 4.5 5.74 4.5 8.5V12.5ZM14.5 12.5V17.5C17.26 17.5 19.5 15.26 19.5 12.5V8.5C19.5 5.74 17.26 3.5 14.5 3.5V7.5H16.25C17.22 7.5 18 8.28 18 9.25C18 10.22 17.22 11 16.25 11H14.5V12.5Z"/>
                            </svg>
                        </button>
                    </div>
                </div>

                <!-- Indicador de procesamiento -->
                <div id="procesandoProductos" class="hidden flex items-center space-x-2 text-blue-300">
                    <div class="animate-spin rounded-full h-4 w-4 border-b-2 border-blue-400"></div>
                    <span class="text-sm">Procesando pedido...</span>
                </div>
            </div>
        </div>

        <!-- Lista de productos identificados -->
        <div id="productosContainer" class="hidden glass-effect p-4 rounded-xl mb-4">
            <div class="flex justify-between items-center mb-3">
                <h3 class="text-white text-lg font-semibold">Productos del Pedido</h3>
                <button onclick="limpiarPedido()" class="text-red-400 hover:text-red-300 text-sm">
                    Limpiar
                </button>
            </div>
            <div id="listaProductos" class="space-y-2 mb-4">
                <!-- Productos aparecerán aquí -->
            </div>
            <div class="border-t border-white/20 pt-3">
                <div class="flex justify-between items-center">
                    <span class="text-white font-semibold">Total:</span>
                    <span class="text-green-400 text-xl font-bold" id="totalPedido">S/ 0.00</span>
                </div>
            </div>
            <button
                id="btnConfirmarPedido"
                onclick="abrirModalCliente()"
                class="w-full mt-4 bg-green-600 hover:bg-green-700 text-white py-3 px-4 rounded-lg font-semibold transition-colors"
            >
                CONFIRMAR PEDIDO
            </button>
        </div>

        <!-- Pedidos recientes compacto -->
        <div class="glass-effect p-4 rounded-xl">
            <div class="flex justify-between items-center mb-3">
                <h3 class="text-white text-base font-semibold">Recientes</h3>
                <button onclick="actualizarPedidos()" class="text-blue-300 hover:text-white transition-colors">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                    </svg>
                </button>
            </div>
            <div id="pedidosRecientes" class="space-y-2">
                <div class="text-center py-4">
                    <p class="text-blue-200 text-sm">No hay pedidos recientes</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para datos del bodeguero -->
    <div id="modalCliente" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="glass-effect rounded-xl p-6 w-full max-w-md max-h-[90vh] overflow-y-auto">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-white text-lg font-semibold">Datos del Bodeguero</h3>
                    <button onclick="cerrarModalCliente()" class="text-blue-300 hover:text-white">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
                
                <div class="space-y-4">
                    <!-- Input para buscar bodeguero -->
                    <div class="space-y-2">
                        <label class="text-blue-200 text-sm">Buscar Bodeguero</label>
                        <div class="relative">
                            <input 
                                type="text" 
                                id="busquedaBodeguero" 
                                placeholder="Nombre, RUC o teléfono del bodeguero"
                                class="w-full pl-4 pr-12 py-2 bg-white/10 border border-white/20 rounded-lg text-white placeholder-blue-300 focus:outline-none focus:border-blue-400"
                                oninput="buscarBodegueroEnTiempoReal()"
                            >
                            <button
                                id="micBodeguero"
                                onclick="toggleRecordingBodeguero()"
                                class="absolute right-3 top-1/2 transform -translate-y-1/2 w-6 h-6 bg-blue-500 hover:bg-blue-600 rounded-full flex items-center justify-center transition-colors"
                            >
                                <svg class="w-3 h-3 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"></path>
                                </svg>
                            </button>
                        </div>
                        
                        <!-- Botón Nueva Bodega -->
                        <button 
                            onclick="mostrarFormularioNuevaBodega()" 
                            class="w-full bg-orange-600 hover:bg-orange-700 text-white py-2 px-4 rounded-lg text-sm transition-colors">
                            + NUEVA BODEGA
                        </button>
                    </div>
                    
                    <!-- Resultados de búsqueda -->
                    <div id="resultadosBusquedaBodeguero" class="space-y-2 max-h-40 overflow-y-auto">
                        <!-- Resultados aparecerán aquí -->
                    </div>
                    
                    <!-- Formulario nueva bodega (inicialmente oculto) -->
                    <div id="formularioNuevaBodega" class="hidden space-y-3 border-t border-white/20 pt-4">
                        <h4 class="text-white font-semibold text-sm">Registrar Nueva Bodega</h4>
                        
                        <!-- RUC con validación automática -->
                        <div>
                            <label class="text-blue-200 text-sm">RUC</label>
                            <div class="relative">
                                <input 
                                    type="text" 
                                    id="nuevoRuc"
                                    placeholder="20123456789"
                                    maxlength="11"
                                    class="w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white placeholder-blue-300 focus:outline-none focus:border-blue-400"
                                    oninput="validarRucEnTiempoReal()"
                                >
                                <div id="validandoRuc" class="hidden absolute right-3 top-1/2 transform -translate-y-1/2">
                                    <div class="animate-spin rounded-full h-4 w-4 border-b-2 border-blue-400"></div>
                                </div>
                            </div>
                            <div id="resultadoValidacionRuc" class="mt-1 text-xs"></div>
                        </div>
                        
                        <!-- Razón Social (se llena automáticamente) -->
                        <div>
                            <label class="text-blue-200 text-sm">Razón Social</label>
                            <input 
                                type="text" 
                                id="nuevaRazonSocial"
                                placeholder="Se llenará automáticamente"
                                class="w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white placeholder-blue-300 focus:outline-none focus:border-blue-400"
                            >
                        </div>
                        
                        <!-- Nombre Comercial -->
                        <div>
                            <label class="text-blue-200 text-sm">Nombre Comercial</label>
                            <input 
                                type="text" 
                                id="nuevoNombreComercial"
                                placeholder="Bodega San Martín"
                                class="w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white placeholder-blue-300 focus:outline-none focus:border-blue-400"
                            >
                        </div>
                        
                        <!-- Dirección -->
                        <div>
                            <label class="text-blue-200 text-sm">Dirección Completa</label>
                            <input 
                                type="text" 
                                id="nuevaDireccion"
                                placeholder="Jr. Los Rosales 123"
                                class="w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white placeholder-blue-300 focus:outline-none focus:border-blue-400"
                            >
                        </div>
                        
                        <!-- Distrito, Provincia, Región -->
                        <div class="grid grid-cols-3 gap-2">
                            <div>
                                <label class="text-blue-200 text-xs">Distrito</label>
                                <input 
                                    type="text" 
                                    id="nuevoDistrito"
                                    placeholder="Lima"
                                    class="w-full px-2 py-2 bg-white/10 border border-white/20 rounded-lg text-white placeholder-blue-300 focus:outline-none focus:border-blue-400 text-sm"
                                >
                            </div>
                            <div>
                                <label class="text-blue-200 text-xs">Provincia</label>
                                <input 
                                    type="text" 
                                    id="nuevaProvincia"
                                    placeholder="Lima"
                                    class="w-full px-2 py-2 bg-white/10 border border-white/20 rounded-lg text-white placeholder-blue-300 focus:outline-none focus:border-blue-400 text-sm"
                                >
                            </div>
                            <div>
                                <label class="text-blue-200 text-xs">Región</label>
                                <input 
                                    type="text" 
                                    id="nuevaRegion"
                                    placeholder="Lima"
                                    class="w-full px-2 py-2 bg-white/10 border border-white/20 rounded-lg text-white placeholder-blue-300 focus:outline-none focus:border-blue-400 text-sm"
                                >
                            </div>
                        </div>
                        
                        <!-- Teléfono/WhatsApp -->
                        <div>
                            <label class="text-blue-200 text-sm">Teléfono/WhatsApp</label>
                            <input 
                                type="tel" 
                                id="nuevoTelefono"
                                placeholder="987654321"
                                class="w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white placeholder-blue-300 focus:outline-none focus:border-blue-400"
                            >
                        </div>
                        
                        <!-- Persona que hace el pedido -->
                        <div>
                            <label class="text-blue-200 text-sm">Persona que hace el pedido</label>
                            <input 
                                type="text" 
                                id="personaPedido"
                                placeholder="Juan Pérez (encargado)"
                                class="w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white placeholder-blue-300 focus:outline-none focus:border-blue-400"
                            >
                        </div>
                        
                        <button 
                            onclick="registrarNuevaBodega()" 
                            class="w-full bg-green-600 hover:bg-green-700 text-white py-2 px-4 rounded-lg transition-colors">
                            Registrar Bodega
                        </button>
                    </div>
                    
                    <!-- Modalidad y plazo de pago -->
                    <div class="border-t border-white/20 pt-4">
                        <label class="text-blue-200 text-sm mb-2 block">Modalidad de Pago</label>
                        <select 
                            id="modalidadPago"
                            class="w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:border-blue-400"
                        >
                            <option value="efectivo_cash">Efectivo - CASH</option>
                            <option value="efectivo_yape">Efectivo - Yape</option>
                            <option value="efectivo_plin">Efectivo - Plin</option>
                            <option value="credito_15_dias" selected>Crédito 15 días</option>
                            <option value="credito_30_dias">Crédito 30 días</option>
                            <option value="credito_45_dias">Crédito 45 días</option>
                        </select>
                    </div>
                    
                    <!-- Observaciones -->
                    <div>
                        <label class="text-blue-200 text-sm">Observaciones (opcional)</label>
                        <textarea 
                            id="observacionesPedido"
                            rows="2"
                            placeholder="Comentarios adicionales"
                            class="w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white placeholder-blue-300 focus:outline-none focus:border-blue-400 resize-none"
                        ></textarea>
                    </div>
                    
                    <button 
                        id="btnEnviarPedido"
                        onclick="enviarPedidoFinal()" 
                        class="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 px-4 rounded-lg font-semibold transition-colors">
                        ENVIAR PEDIDO
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="js/vendedor/ventas_externas.js"></script>
</body>
</html>